<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>‡πÄ‡∏Å‡∏°‡∏á‡∏π‡∏Ç‡∏≤‡∏ß‡∏î‡∏≥</title>
<style>
  body { 
    display: flex; 
    justify-content: center; 
    align-items: center; 
    height: 100vh; 
    background: #000; 
    flex-direction: column; 
    margin: 0;
    font-family: sans-serif;
  }
  canvas { background: #fff; z-index:0;}
  #score, #highscore {
    color: #fff; 
    font-size: 20px; 
    margin: 5px;
  }
  .overlay {
    position: absolute;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.8);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    color: white;
    text-align: center;
    z-index: 1;
  }
  button {
    padding: 10px 25px;
    font-size: 18px;
    border: none;
    border-radius: 8px;
    background: #00ff99;
    color: #000;
    cursor: pointer;
    margin-top: 15px;
    transition: 0.2s;
  }
  button:hover { background: #00cc77; transform: scale(1.05); }
</style>
</head>
<body>

<div id="score">Score: 0</div>
<div id="highscore">High Score: 0</div>
<canvas id="game" width="400" height="400"></canvas>

<!-- ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏°‡∏ô‡∏π -->
<div id="menu" class="overlay">
  <h1>üêç ‡∏´‡∏ô‡∏≠‡∏ô‡∏°‡∏≤‡πÅ‡∏ß‡πâ‡∏ß </h1>
  <p>‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏•‡πà‡∏ô</p>
  <button id="startBtn">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°</button>
</div>

<!-- ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠ Game Over -->
<div id="gameOver" class="overlay" style="display:none;">
  <h1>üíÄ Game Over üíÄ</h1>
  <p id="finalScore">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì: 0</p>
  <p id="bestScore">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î: 0</p>
  <button id="restartBtn">‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏´‡∏°‡πà</button>
  <button id="menuBtn">‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏°‡∏ô‡∏π</button>
</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const scoreEl = document.getElementById("score");
const highEl = document.getElementById("highscore");

const menu = document.getElementById("menu");
const startBtn = document.getElementById("startBtn");
const gameOver = document.getElementById("gameOver");
const restartBtn = document.getElementById("restartBtn");
const menuBtn = document.getElementById("menuBtn");
const finalScore = document.getElementById("finalScore");
const bestScore = document.getElementById("bestScore");

const grid = 20;
let count = 0;
let snake, apple, dx, dy, score;
let playing = false;


// ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á
const eatSound = new Audio("eat.mp3");
const dieSound = new Audio("did.mp3");

// ‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡∏à‡∏≤‡∏Å localStorage
let highScore = localStorage.getItem("snake_highscore") || 0;
highEl.textContent = "High Score: " + highScore;

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‡πÉ‡∏´‡∏°‡πà
function resetGame() {
  snake = [{x: 8, y: 8}];
  apple = {x: Math.floor(Math.random()*20), y: Math.floor(Math.random()*20)};
  dx = 0; dy = 0; // ‡∏£‡∏≠‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°
  score = 0;
  scoreEl.textContent = "Score: 0";

  // ‡∏ß‡∏≤‡∏î‡∏™‡∏ô‡∏≤‡∏°‡πÅ‡∏•‡∏∞‡∏á‡∏π‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á
  drawField();
  drawSnake();
  drawApple();
}

function drawField() {
  ctx.fillStyle = "#6aaa4f";
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  ctx.strokeStyle = "#4c9a2a";
  ctx.lineWidth = 1;
  for(let x=0; x<=canvas.width; x+=grid){
    ctx.beginPath(); ctx.moveTo(x,0); ctx.lineTo(x,canvas.height); ctx.stroke();
  }
  for(let y=0; y<=canvas.height; y+=grid){
    ctx.beginPath(); ctx.moveTo(0,y); ctx.lineTo(canvas.width,y); ctx.stroke();
  }
}

function drawSnake() {
  snake.forEach((seg, i) => {
    ctx.fillStyle = "#000";
    ctx.fillRect(seg.x*grid, seg.y*grid, grid-1, grid-1);
    if(i === 0){
      ctx.fillStyle = "#fff";
      ctx.fillRect(seg.x*grid + 3, seg.y*grid + 3, 3, 3);
      ctx.fillRect(seg.x*grid + grid - 6, seg.y*grid + 3, 3, 3);
    }
  });
}

function drawApple() {
  ctx.fillStyle = "red";
  ctx.fillRect(apple.x*grid, apple.y*grid, grid-1, grid-1);
}

function gameLoop() {
  if (!playing) return;
  requestAnimationFrame(gameLoop);

  if(dx === 0 && dy === 0) return; // ‡∏£‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏Å‡πà‡∏≠‡∏ô

  if (++count < 10) return;
  count = 0;

  const head = {x: snake[0].x + dx, y: snake[0].y + dy};

  // ‡∏ä‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡∏´‡∏£‡∏∑‡∏≠‡∏Ç‡∏≠‡∏ö
  if (
    snake.some(seg => seg.x === head.x && seg.y === head.y) ||
    head.x < 0 || head.x >= canvas.width/grid ||
    head.y < 0 || head.y >= canvas.height/grid
  ) {
    dieSound.currentTime = 0; dieSound.play();

    if (score > highScore) {
      highScore = score;
      localStorage.setItem("snake_highscore", highScore);
    }
    highEl.textContent = "High Score: " + highScore;
    finalScore.textContent = "‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì: " + score;
    bestScore.textContent = "‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î: " + highScore;

    playing = false;
    gameOver.style.display = "flex";
    return;
  }

  snake.unshift(head);

  if (head.x === apple.x && head.y === apple.y) {
    eatSound.currentTime = 0; eatSound.play();
    score++;
    scoreEl.textContent = "Score: " + score;
    apple = {x: Math.floor(Math.random()*20), y: Math.floor(Math.random()*20)};
  } else {
    snake.pop();
  }

  drawField();
  drawSnake();
  drawApple();
}

// ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°
startBtn.onclick = restartBtn.onclick = () => {
  menu.style.display = "none";
  gameOver.style.display = "none";
  playing = true;
  resetGame();
  requestAnimationFrame(gameLoop);
};

// ‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏°‡∏ô‡∏π
menuBtn.onclick = () => {
  gameOver.style.display = "none";
  menu.style.display = "flex";
  resetGame();
};

// ‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏ó‡∏¥‡∏®‡∏ó‡∏≤‡∏á
window.addEventListener("keydown", e => {
  if (!playing) return;
  switch(e.key.toLowerCase()) {
    case "w": if(dy === 0) {dx=0; dy=-1;} break;
    case "s": if(dy === 0) {dx=0; dy=1;} break;
    case "a": if(dx === 0) {dx=-1; dy=0;} break;
    case "d": if(dx === 0) {dx=1; dy=0;} break;
  }
});

// ‡∏ß‡∏≤‡∏î‡∏™‡∏ô‡∏≤‡∏°+‡∏á‡∏π‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤
resetGame();
</script>
</body>
</html>
